// games-mock.js.js
const games = [
    {
        id: 1136,
        title: 'Overwatch 2',
        thumbnail: 'https://www.mmobomb.com/g/1136/thumbnail.jpg',
        short_description: 'Big changes come to the Overwatch formula in this sequel...and so does PvE content, eventually.',
        game_url: 'https://www.mmobomb.com/open/overwatch-2',
        genre: 'Shooter',
        platform: 'PC (Windows)',
        publisher: 'Activision Blizzard King',
        developer: 'Blizzard Entertainment',
        release_date: '2022-10-04',
        profile_url: 'https://www.mmobomb.com/overwatch-2',
    },
    {
        id: 523,
        title: 'Lost Ark',
        thumbnail: 'https://www.mmobomb.com/g/523/thumbnail.jpg',
        short_description: 'Journey throughout the realm of Arkesia and do battle against a demon invasion in Smilegate\'s free-to-play ARPG Lost Ark!',
        game_url: 'https://www.mmobomb.com/open/lost-ark',
        genre: 'ARPG',
        platform: 'PC (Windows)',
        publisher: 'Amazon Games',
        developer: 'Smilegate',
        release_date: '2022-02-11',
        profile_url: 'https://www.mmobomb.com/lost-ark',
    },
    {
        id: 1113,
        title: 'PUBG: BATTLEGROUNDS',
        thumbnail: 'https://www.mmobomb.com/g/1113/thumbnail.jpg',
        short_description: 'Battle the odds in a 100v1 death match in PUBG: Battlegrounds, the classic free-to-play battle royale experience.',
        game_url: 'https://www.mmobomb.com/open/pubg',
        genre: 'Shooter',
        platform: 'PC (Windows)',
        publisher: 'KRAFTON, Inc.',
        developer: 'KRAFTON, Inc.',
        release_date: '2022-01-12',
        profile_url: 'https://www.mmobomb.com/pubg',
    },
    {
        id: 508,
        title: 'Enlisted',
        thumbnail: 'https://www.mmobomb.com/g/508/thumbnail.jpg',
        short_description: 'Step into the most famous battles of World War II in Enlisted, a free-to-play shooter from the makers of War Thunder. Experience squad-based combat from the ground level, as you command your troops, outfitted with era-authentic weapons and gear, in massive battles with over a hundred soldiers apiece.',
        game_url: 'https://www.mmobomb.com/open/enlisted',
        genre: 'Shooter',
        platform: 'PC (Windows)',
        publisher: 'Gaijin Entertainment',
        developer: 'Darkflow Software',
        release_date: '2021-04-08',
        profile_url: 'https://www.mmobomb.com/enlisted',
    },
    {
        id: 1120,
        title: 'Fall Guys',
        thumbnail: 'https://www.mmobomb.com/g/1120/thumbnail.jpg',
        short_description: 'Fall Guys is a free-to-play massively multiplayer party royale game.',
        game_url: 'https://www.mmobomb.com/open/fall-guys',
        genre: 'Battle Royale',
        platform: 'PC (Windows)',
        publisher: 'Mediatonic',
        developer: 'Mediatonic',
        release_date: '2020-08-04',
        profile_url: 'https://www.mmobomb.com/fall-guys',
    },
    {
        id: 340,
        title: 'Game Of Thrones Winter Is Coming',
        thumbnail: 'https://www.mmobomb.com/g/340/thumbnail.jpg',
        short_description: 'Fame and glory await you in Westeros, in Game of Thrones: Winter Is Coming, the officially licensed free-to-play browser game based on the epic fantasy series by George R.R. Martin.',
        game_url: 'https://www.mmobomb.com/open/game-of-thrones-winter-is-coming',
        genre: 'Strategy',
        platform: 'Web Browser',
        publisher: 'GTArcade',
        developer: 'YOOZOO Games ',
        release_date: '2019-11-14',
        profile_url: 'https://www.mmobomb.com/game-of-thrones-winter-is-coming',
    },
    {
        id: 427,
        title: 'Drakensang Online',
        thumbnail: 'https://www.mmobomb.com/g/427/thumbnail.jpg',
        short_description: 'Drakensang Online is a free to play 3D action RPG game that features extraordinary 3D graphics and effects and heralds the next generation of free-to-play online browser games. With the ability to customize your character, skills and magic powers like never before, join your comrades to wage a brutal war against evil.',
        game_url: 'https://www.mmobomb.com/open/drakensang-online',
        genre: 'MMORPG',
        platform: 'Web Browser',
        publisher: 'Bigpoint',
        developer: 'Bigpoint',
        release_date: '2011-08-08',
        profile_url: 'https://www.mmobomb.com/drakensang-online',
    },
    {
        id: 380,
        title: 'Dark Orbit Reloaded',
        thumbnail: 'https://www.mmobomb.com/g/380/thumbnail.jpg',
        short_description: 'Take part in huge intergalactic battles and take on the whole galaxy in DarkOrbit, the free-to-play browser-based space combat MMO from Bigpoint -- now in 3-D! Choose your faction and your ship, each with their own strengths, and take off into adventure!',
        game_url: 'https://www.mmobomb.com/open/darkorbit',
        genre: 'Shooter',
        platform: 'Web Browser',
        publisher: 'Bigpoint',
        developer: 'Bigpoint',
        release_date: '2006-12-11',
        profile_url: 'https://www.mmobomb.com/darkorbit',
    },
    {
        id: 1122,
        title: 'MultiVersus',
        thumbnail: 'https://www.mmobomb.com/g/1122/thumbnail.jpg',
        short_description: 'Match up in 1v1, 2v2 co-op, or 4-person free-for-all modes in this free-to-play Smash-Style Brawler!',
        game_url: 'https://www.mmobomb.com/open/multiversus',
        genre: 'Fighting',
        platform: 'PC (Windows)',
        publisher: 'Warner Bros. Games',
        developer: 'Player First Games',
        release_date: '2022-07-19',
        profile_url: 'https://www.mmobomb.com/multiversus',
    },
    {
        id: 5,
        title: 'Crossout',
        thumbnail: 'https://www.mmobomb.com/g/5/thumbnail.jpg',
        short_description: 'Trick out your ride and take to the post-apocalyptic roads for battle in Crossout, the free-to-play vehicular combat game from Gaijin Entertainment! Featuring a vehicle design system with endless customization and fast-paced, armor-crunching combat, Crossout offers high-octane excitement in brief and explosive matches.',
        game_url: 'https://www.mmobomb.com/open/crossout',
        genre: 'Shooter',
        platform: 'PC (Windows)',
        publisher: 'Targem',
        developer: 'Gaijin',
        release_date: '2017-05-30',
        profile_url: 'https://www.mmobomb.com/crossout',
    },
];

function debounce(func, timeout = 300) {
    let timer;
    return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => { func.apply(this, args); }, timeout);
    };
}

document.addEventListener('DOMContentLoaded', () => {
    const checkboxes = document.querySelectorAll('.checkbox__input');
    const containerCards = document.querySelector('.main.cards');
    const genreDropdown = document.getElementById('genre');
    const textInput = document.querySelector('.search__input');
    const radioButtons = document.querySelectorAll('.radio__input');

    const filtersState = {
        checkboxes: [],
        selectedGenre: 'all',
        textValue: '',
        selectedRadio: '',
    };

    function setCardItemVisibility(cardItem, isVisible) {
        if (isVisible) {
            cardItem.classList.remove('hidden');
        } else {
            cardItem.classList.add('hidden');
        }
    }

    function createCardTemplate(game) {
        return `<li class="card__item" data-release-date="${game.release_date}" data-genre="${game.genre}" data-platform="${game.platform}">
                        <div class="card__view">
                            <img src="${game.thumbnail}" alt="game picture" width="90" height="90">
                            <div>
                                <h3 class="card__title">${game.title}</h3>
                                <p>${game.short_description}</p>
                            </div>
                        </div>
                        <dl class="item-descriptions">
                            <div>
                                <dt>Platform</dt>
                                <dd>${game.platform}</dd>
                            </div>

                            <div>
                                <dt>Publisher</dt>
                                <dd>${game.publisher}</dd>
                            </div>

                            <div>
                                <dt>Developer</dt>
                                <dd>${game.developer}</dd>
                            </div>

                            <div>
                                <dt>Genre</dt>
                                <dd>${game.genre}</dd>
                            </div>

                            <div>
                                <dt>Release_date</dt>
                                <dd >${game.release_date}</dd>
                            </div>
                        </dl>
                    </li>`;
    }

    function renderCards(container) {
        const cardsHTML = games.map(createCardTemplate).join('');
        container.querySelector('.section__title').insertAdjacentHTML('afterend', `<ul class="card__list">${cardsHTML}</ul>`);
    }

    function updateState() {
        filtersState.checkboxes = [...checkboxes].filter((checkbox) => checkbox.checked);
        filtersState.selectedGenre = genreDropdown.options[genreDropdown.selectedIndex].value;
        filtersState.textValue = textInput.value.toLowerCase();
        filtersState.selectedRadio = [...radioButtons].find((radio) => radio.checked).value;
    }

    function applyRadioFilter(cardItem) {
        const textContent = cardItem.textContent.toLowerCase();
        const platform = (cardItem.dataset.platform).toLowerCase();

        const isPlatformVisible = filtersState.selectedRadio === 'platform' && platform.includes('pc (windows)');
        const isOnlineVisible = filtersState.selectedRadio === 'online' && textContent.includes('web browser');
        const isAllVisible = filtersState.selectedRadio === 'all';

        return isPlatformVisible || isOnlineVisible || isAllVisible;
    }

    function applyCheckboxFilter(cardItem) {
        const releaseDate = new Date(cardItem.dataset.releaseDate).getFullYear();
        const isOld = releaseDate < 2010;
        const isNew = releaseDate > 2020;

        return (filtersState.checkboxes.length === 0
            || filtersState.checkboxes.some(({ value }) => (value === 'new' && isNew)
                || (value === 'old' && isOld)));
    }

    function applyTextSearchFilter(cardItem) {
        const textContent = cardItem.textContent.toLowerCase();

        return textContent.includes(filtersState.textValue);
    }

    function applyDropdownFilter(cardItem) {
        const genre = (cardItem.dataset.genre).toLowerCase();

        return (filtersState.selectedGenre === 'all' || genre === filtersState.selectedGenre);
    }

    function updateVisibility(cardItem) {
        const visibleRadioFilter = applyRadioFilter(cardItem);
        const checkboxFilter = applyCheckboxFilter(cardItem);
        const textSearch = applyTextSearchFilter(cardItem);
        const dropdownFilter = applyDropdownFilter(cardItem);

        const isVisible = checkboxFilter && dropdownFilter && textSearch && visibleRadioFilter;

        setCardItemVisibility(cardItem, isVisible);
    }
    function updateFilter() {
        const cardItems = document.querySelectorAll('.card__item');
        cardItems.forEach(updateVisibility);
    }

    function init() {
        renderCards(containerCards);

        const updateAndFilter = () => {
            updateState();
            updateFilter();
        };

        checkboxes.forEach((checkbox) => checkbox.addEventListener('change', updateAndFilter));
        genreDropdown.addEventListener('change', updateAndFilter);
        textInput.addEventListener('input', debounce(updateAndFilter, 300));
        radioButtons.forEach((radio) => radio.addEventListener('change', updateAndFilter));
    }

    init();
});
